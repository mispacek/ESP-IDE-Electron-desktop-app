<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=0.80, maximum-scale=1.0, user-scalable=yes" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title data-i18n="fileManager.title">File Manager</title>
    <link rel="stylesheet" href="filemanager.css?v=04_11_2025">

  <!-- SweetAlert2 -->
  <script src="js/sweetalert2.all.min.js?v=04_11_2025"></script>
  <link rel="stylesheet" href="css/sweetalert2.min.css?v=04_11_2025">

  <style>
    /* Safe SweetAlert2 behavior in a custom layout */
    html.swal2-shown, body.swal2-shown { overflow: initial !important; }
    body.swal2-height-auto { height: auto !important; }
    /* Render inside #swal-root so it sits on top without a global backdrop */
    #swal-root { position: fixed; inset: 0; z-index: 2147483647; pointer-events: none; }
    #swal-root .swal2-container { pointer-events: all; }
  </style>

</head>
<body>
    <div id="fm_root">
    <div class="file-manager">
        <div class="toolbar">
            <input type="file" id="file-upload" style="display: none;" multiple>
            <button id="upload"><img src="media/icons/upload.png" class="icon"> <span data-i18n="fileManager.toolbar.upload">Upload to ESP</span></button>
            <button id="download"><img src="media/icons/download.png" class="icon"> <span data-i18n="fileManager.toolbar.download">Download to PC</span></button>
            <button id="move-to"><img src="media/icons/move.png" class="icon"> <span data-i18n="fileManager.toolbar.move">Move</span></button>
            <button id="copy-to"><img src="media/icons/copy.png" class="icon"> <span data-i18n="fileManager.toolbar.copy">Copy</span></button>
            <button id="rename"><img src="media/icons/rename.png" class="icon"> <span data-i18n="fileManager.toolbar.rename">Rename</span></button>
            <button id="new-folder"><img src="media/icons/new_folder.png" class="icon"> <span data-i18n="fileManager.toolbar.newFolder">New folder</span></button>
            <button id="delete"><img src="media/icons/delete.png" class="icon"> <span data-i18n="fileManager.toolbar.delete">Delete</span></button>
            <button id="clear-selection"><img src="media/icons/clear.png" class="icon"> <span data-i18n="fileManager.toolbar.clearSelection">Clear selection</span></button>
            <button id="close-fm"><img src="media/icons/exit.png" class="icon"> <span data-i18n="fileManager.toolbar.close">Close</span></button>
        </div>
        <div id="breadcrumb-container">
            <div class="breadcrumb" id="breadcrumb"></div>
            <div id="status-container">
                <div id="progressbar-container">
                    <div id="progressbar"></div>
                </div>
                <div id="memory-status"></div>
            </div>
        </div>
        <div class="file-list" id="file-list" ondrop="handleDrop(event)" ondragover="allowDrop(event)">
            <table id="file-table">
                <thead>
                    <tr>
                        <th data-i18n="fileManager.table.selected">Selected</th>
                        <th data-i18n="fileManager.table.name">Name</th>
                        <th data-i18n="fileManager.table.size">Size</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dynamic file listing -->
                </tbody>
            </table>
        </div>
        <div id="error-message" style="color: red;"></div>
    </div>
    <div id="popup-overlay" class="popup-overlay" style="display: none;">
        <div id="popup-window" class="popup-window">
            <div id="popup-content"></div>
            <button id="popup-close" class="popup-button" data-i18n="fileManager.popup.close">Close</button>
        </div>
    </div>

    </div>

    <script>
      (function(){
        try {
          var saved = localStorage.getItem("userSettings");
          var data = saved ? JSON.parse(saved) : {};
          var isDark = data && data.theme === "dark";
          document.documentElement.classList.toggle("theme-dark", !!isDark);
        } catch (e) {}
      })();
    </script>
</body>
</html>
