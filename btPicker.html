<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<title>Výběr Bluetooth zařízení</title>
<style>
  /* layout jako portPicker */
  html,body{height:100%;margin:0}
  body{font-family:sans-serif;display:flex;flex-direction:column;background:#fff;color:#000}
  h2{margin:12px 0;text-align:center;font-weight:600}

  /* scrollovací seznam zařízení */
  #devList{
    flex:1;
    overflow-y:auto;
    padding:0 16px 8px;
    display:flex;flex-direction:column;gap:8px;
  }

  /* dlaždice zařízení */
  .devBtn{
    background:#efefef;border:none;border-radius:8px;width:100%;
    padding:8px 12px;text-align:left;cursor:pointer;transition:background .15s;
  }
  .devBtn:hover{background:#c8f1c8;} /* pastelová zelená jako u portů */
  .dev-name{font-size:15px;font-weight:600}
  .dev-info{font-size:12px;color:#555;margin-top:2px}

  /* spodní lišta */
  #closeRow{padding:10px 0;text-align:center;border-top:1px solid #ddd}
  #closeBtn{padding:6px 18px;border:none;border-radius:6px;background:#9e9e9e;color:#fff;cursor:pointer}
  #closeBtn:hover{background:#bdbdbd}

  .empty{font-size:14px;color:#666;padding:12px}
  .mono{font-family:ui-monospace,Consolas,monospace}
</style>
</head>
<body>
  <h2>Vyber Bluetooth zařízení</h2>

  <div id="devList"><div class="empty">Hledám zařízení…</div></div>

  <div id="closeRow"><button id="closeBtn">Zavřít</button></div>

<script>
  const devListEl = document.getElementById('devList');

  function esc(s){return String(s).replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]))}

  function render(list){
    devListEl.innerHTML = '';
    if (!list || !list.length){
      devListEl.innerHTML = '<div class="empty">Nic nenalezeno. Zkontrolujte, že je zařízení zapnuté a v dosahu.</div>';
      return;
    }
    for (const d of list){
      const name = d.name && d.name.trim() ? d.name : '(nepojmenované)';
      const id = d.id || '';
      const btn = document.createElement('button');
      btn.className = 'devBtn';
      btn.innerHTML =
        `<div class="dev-name">${esc(name)}</div>
         <div class="dev-info">ID: <span class="mono">${esc(id)}</span></div>`;
      btn.onclick = () => window.btPicker.choose(id);
      devListEl.appendChild(btn);
    }
  }

  // přijímání průběžných výsledků skenu
  window.btPicker.onDevices(render);

  // zrušení výběru
  document.getElementById('closeBtn').onclick = () => window.btPicker.cancel();
  
  window.addEventListener('keydown', e => { if (e.key === 'Escape') window.btPicker.cancel(); });

  
</script>



</body>
</html>
